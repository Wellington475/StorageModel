"use strict";function Collection(t,e){this.model=e,this[this.model.toLowerCase()]=t}function StorageModel(t){if(this.model=t,this.columns=[],this.fields={},localStorage.getItem(this.model)){var e=JSON.parse(localStorage.getItem(this.model))||[];e.length>0&&(this.columns=Object.keys(e[0]))}}Collection.prototype.toArray=Collection.prototype.get=function(){return this[this.model.toLowerCase()]},Collection.prototype.first=function(){return this[this.model.toLowerCase()][0]},Collection.prototype.take=function(t){return this[this.model.toLowerCase()].splice(0,t)},Collection.prototype.count=function(){return this[this.model.toLowerCase()].length},Collection.prototype.orderBy=function(t,e){return this[this.model.toLowerCase()].sort(function(e,o){return e[t]>o[t]}),e&&"dec"==e.toLowerCase()?new Collection(this[this.model.toLowerCase()].reverse(),this.model):new Collection(this[this.model.toLowerCase()],this.model)},Collection.prototype.each=function(t){this[this.model.toLowerCase()].forEach(function(e){t(e)})},Collection.prototype.update=function(t){var e=Object.keys(t);if(e.length>0){var o=(this[this.model.toLowerCase()].length,JSON.parse(localStorage.getItem(this.model))||[]),r=[];return this[this.model.toLowerCase()].forEach(function(t){r.push(t.id)}),o.forEach(function(o){e.forEach(function(e){r.indexOf(o.id)>-1&&(o[e]=t[e])})}),o=JSON.stringify(o),localStorage.setItem(this.model,o),!0}return!1},StorageModel.prototype.create=function(t){var e=[],o=1;return localStorage.getItem(this.model)&&(e=JSON.parse(localStorage.getItem(this.model)),null!=e&&e.length>0?(o=e[e.length-1].id,o+=1):o=1),this.fields=t,this.fields.id=o,this.fields.status=1,0==e.length&&(this.columns=Object.keys(this.fields)),e.push(this.fields),e=JSON.stringify(e),localStorage.setItem(this.model,e),this.fields},StorageModel.prototype.find=function(t){var e=JSON.parse(localStorage.getItem(this.model))||[];if("number"==typeof t){var o=this;return e.forEach(function(e){e.id==t&&(o.fields=e)}),this.fields}var r=[],i=Object.keys(t)[0];if(this.columns.indexOf(i)>-1)return e.forEach(function(e){(e[i]==t[i]||String(e[i]).indexOf(t[i])>-1)&&r.push(e)}),new Collection(r,this.model)},StorageModel.prototype.update=function(t,e){var o=JSON.parse(localStorage.getItem(this.model))||[];if(o.length>0){var r=Object.keys(t),i=this;return o.forEach(function(o){o.id==e&&(r.forEach(function(e){o[e]=t[e]}),i.fields=o)}),o=JSON.stringify(o),localStorage.setItem(this.model,o),i.fields}return!1},StorageModel.prototype.where=function(){var args=arguments,items=[];if(2==args.length){var ram=JSON.parse(localStorage.getItem(this.model))||[],self=this;return self.fields={},ram.forEach(function(t){t[args[0]]==args[1]&&items.push(t)}),new Collection(items,this.model)}if(3==args.length){var ram=JSON.parse(localStorage.getItem(this.model))||[],self=this,expression;return ram.forEach(function(item){expression=eval(item[args[0]]+" "+args[1]+" "+args[2]),expression&&items.push(item)}),new Collection(items,this.model)}return[]},StorageModel.prototype.all=function(){var t=JSON.parse(localStorage.getItem(this.model))||[];return new Collection(t,this.model)},StorageModel.prototype.count=function(){var t=JSON.parse(localStorage.getItem(this.model))||[];return t.length},StorageModel.prototype.remove=function(t,e){if(localStorage.getItem(this.model)){var o=JSON.parse(localStorage.getItem(this.model))||[],r=0;return o.forEach(function(e){e.id==t&&(r=o.indexOf(e))}),e?1!=e&&"f"!=e.toLowerCase()||o.splice(r,1):o[r].status=0,o=JSON.stringify(o),localStorage.setItem(this.model,o),!0}return!1},StorageModel.prototype.dropModel=function(){return!!localStorage.getItem(this.model)&&(localStorage.setItem(this.model,[]),!0)},StorageModel.prototype.drop=function(){return localStorage.clear(),!0};